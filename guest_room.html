<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방명록 게시판</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="./header.css">
    <style>
        .button_container {
            margin-top: 100px;
        }

        .table_container {
            margin-top: 80px;
        }

        .btn {
            font-size: 16px;
        }
    </style>
    <script type="module">
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDh6zLnyROVOfCWvNFUc7ZuA8vwcfetQfg",
            authDomain: "sparta-c733d.firebaseapp.com",
            projectId: "sparta-c733d",
            storageBucket: "sparta-c733d.appspot.com",
            messagingSenderId: "1031155272900",
            appId: "1:1031155272900:web:cb870f935defdb8088cd91",
            measurementId: "G-E2LVXM0BPR"
        };


        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let entryNumber = 1;
        
        async function populateTable() {
            const querySnapshot = await getDocs(collection(db, "guestbook_entries"));
            querySnapshot.forEach((doc) => {
                const name = doc.data()["input-name"];
                const guestbook = doc.data()["input-guestbook"];

                const newRow = document.createElement("tr");

                const numberCell = document.createElement("td");
                numberCell.textContent = entryNumber; 
                newRow.appendChild(numberCell);

                const nameCell = document.createElement("td");
                nameCell.textContent = name;
                newRow.appendChild(nameCell);

                const guestbookCell = document.createElement("td");
                guestbookCell.textContent = guestbook;
                newRow.appendChild(guestbookCell);

                document.querySelector("tbody").appendChild(newRow);
                entryNumber++; 
            });
        }
        populateTable();
        

    </script>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <a class="navbar-brand mx-auto" href="#">우리... 할 수 있조 🔥</a>
        <div class="d-flex" role="search">
        </div>
    </nav>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div class="button_container">
                    <button type="button" class="btn btn-primary" onclick="openGuestBookPage()">내가 쓴 방명록 수정/삭제</button>
                </div>
            </div>
            <div class="col-md-6">
                <div class="button_container text-end">
                    <button type="button" class="btn btn-primary" onclick="openGuestInputPage()">방명록 남기기</button>
                    <!-- 수정된 버튼 -->
                    <button type="button" class="btn btn-secondary" onclick="refreshPage()">새로고침</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container table_container">
        <table class="table table-hover table-sm text-center">
            <thead>
                <tr>
                    <th scope="col">번호</th>
                    <th scope="col">이름</th>
                    <th scope="col">작성글 내용</th>
                </tr>
            </thead>
            <tbody>
                <!-- 테이블 내용 파이어베이스에서 불러옴 -->
            </tbody>
        </table>
    </div>

    <script>
        function openGuestInputPage() {
            window.open('guest_input.html', '_blank');
        }

        function openGuestBookPage() {
            window.location.href = 'guest_book.html';
        }

        function refreshPage() {
            location.reload();
        }
    </script>
</body>

</html>
